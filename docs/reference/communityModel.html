<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Create a community (multi-species) occupancy model for JAGS or Nimble — communityModel • camtrapR</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Create a community (multi-species) occupancy model for JAGS or Nimble — communityModel"><meta property="og:description" content="Flexibly creates complete code and input data for community occupancy models for JAGS amd Nimble (both standard occupancy models and Royle-Nichols occupancy models), and automatically sets initial values and parameters to monitor. 
Supports fixed and random effects of covariates on detection and occupancy probabilities, using both continuous and categorical covariates (both site and site-occasion covariates).
Optionally includes data augmentation (fully open community, or up to known maximum number of species, or no data augmentation). 
Allows combination of all these parameters for fast and flexible customization of community occupancy models.
Incidentally, the function can also be used to create model code and input for single-species single-season occupancy models (it is the special case of the community model with only one species). 
Such a model will run slower than proper single-species model JAGS code due to the additional species loop, but it is possible.
The function returns several derived quantities, e.g. species richness, Bayesian p-values (overall and by species), Freeman-Tukey residuals for actual and simulated data (by station and total). If doing data augmentation, metacommunity size and number of unseen species are returned also."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">camtrapR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/camtrapr1.html">1. Organising raw camera trap images in camtrapR</a>
    </li>
    <li>
      <a href="../articles/camtrapr2.html">2. Species and Individual Identification</a>
    </li>
    <li>
      <a href="../articles/camtrapr3.html">3. Data Extraction from Images and videos, creating occupancy &amp; secr input</a>
    </li>
    <li>
      <a href="../articles/camtrapr4.html">4. Data exploration and visualisation</a>
    </li>
    <li>
      <a href="../articles/camtrapr5.html">5. Multi-species occupancy models</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/jniedballa/camtrapR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create a community (multi-species) occupancy model for JAGS or Nimble</h1>
    <small class="dont-index">Source: <a href="https://github.com/jniedballa/camtrapR/blob/HEAD/R/communityModel.R" class="external-link"><code>R/communityModel.R</code></a></small>
    <div class="hidden name"><code>communityModel.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Flexibly creates complete code and input data for community occupancy models for JAGS amd Nimble (both standard occupancy models and Royle-Nichols occupancy models), and automatically sets initial values and parameters to monitor. 
Supports fixed and random effects of covariates on detection and occupancy probabilities, using both continuous and categorical covariates (both site and site-occasion covariates).</p>
<p>Optionally includes data augmentation (fully open community, or up to known maximum number of species, or no data augmentation). 
Allows combination of all these parameters for fast and flexible customization of community occupancy models.</p>
<p>Incidentally, the function can also be used to create model code and input for single-species single-season occupancy models (it is the special case of the community model with only one species). 
Such a model will run slower than proper single-species model JAGS code due to the additional species loop, but it is possible.</p>
<p>The function returns several derived quantities, e.g. species richness, Bayesian p-values (overall and by species), Freeman-Tukey residuals for actual and simulated data (by station and total). If doing data augmentation, metacommunity size and number of unseen species are returned also.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">communityModel</span><span class="op">(</span></span>
<span>  <span class="va">data_list</span>,</span>
<span>  model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Occupancy"</span>, <span class="st">"RN"</span><span class="op">)</span>,</span>
<span>  occuCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="cn">NULL</span>, independent <span class="op">=</span> <span class="cn">NULL</span>, ranef <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>,</span>
<span>  detCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="cn">NULL</span>, ranef <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>,</span>
<span>  detCovsObservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="cn">NULL</span>, ranef <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>,</span>
<span>  speciesSiteRandomEffect <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="cn">FALSE</span>, occu <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  intercepts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"fixed"</span>, occu <span class="op">=</span> <span class="st">"fixed"</span><span class="op">)</span>,</span>
<span>  effortCov <span class="op">=</span> <span class="st">"effort"</span>,</span>
<span>  richnessCategories <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  augmentation <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  modelFile <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  nimble <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  keyword_quadratic <span class="op">=</span> <span class="st">"_squared"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>data_list</dt>
<dd><p>list. Contains 3 slots: ylist, siteCovs, obsCovs. ylist is a list of detection histories (can be named), e.g. from <code><a href="detectionHistory.html">detectionHistory</a></code>. siteCovs is a data.frame with site covariates (optional). obsCovs is a list of site-occasion level covariates (e.g. site-occasion-specific effort, which is also returned by <code><a href="detectionHistory.html">detectionHistory</a></code>.</p></dd>


<dt>model</dt>
<dd><p>character. "Occupancy" for standard occupancy model,  or "RN" for the occupancy model of Royle and Nichols (2003), which relates probability of detection of the species to the number of individuals available for detection at each station</p></dd>


<dt>occuCovs</dt>
<dd><p>list. Up to 3 items named "fixed", "independent", and/or "ranef". Specifies fixed, independent or random effects of covariates on occupancy probability (continuous or categorical covariates). Independent effects are only supported for continuous covariates.</p></dd>


<dt>detCovs</dt>
<dd><p>list. Up to 3 items named "fixed", "independent", and/or "ranef". Specifies fixed, independent or random effects of covariates on detection probability (continuous or categorical covariates). Independent effects are only supported for continuous covariates.</p></dd>


<dt>detCovsObservation</dt>
<dd><p>list. Up to 2 items named "fixed" and/or "ranef". Specifies fixed or random effects of observation-level covariates on detection probability  (continuous or categorical covariates - categorical must be coded as character matrix)</p></dd>


<dt>speciesSiteRandomEffect</dt>
<dd><p>list. Two items named "det" and "occu". If TRUE, adds a random effect of species and station. Only implemented for detection probability.</p></dd>


<dt>intercepts</dt>
<dd><p>list. Two items named "det" and "occu" for detection and occupancy probability intercepts. Values can be "fixed" (= constant across species), "independent" (= independent estimates for each species), or "ranef" (= random effect of species on intercept).</p></dd>


<dt>effortCov</dt>
<dd><p>character. Name of list item in <code>data_list$obsCovs</code> which contains effort. This does not include effort as a covariate on detection probability, but only uses NA / not NA information to create binary effort and ensure detection probabilities p are 0 when there was no effort (p will be 0 whereever <code>effortCov</code> is NA).</p></dd>


<dt>richnessCategories</dt>
<dd><p>character. Name of categorical covariate in <code>data_list$siteCovs</code> for which to calculate separate richness estimates (optional). Can be useful to obtain separate richness estimates for different areas.</p></dd>


<dt>augmentation</dt>
<dd><p>If NULL, no data augmentation (only use species in <code>data_list$ylist</code>), otherwise named list or vector with total number of (potential) species. Names: "maxknown" or "full". Example: <code>augmentation = c(maxknown = 30)</code> or <code>augmentation = c(full = 30)</code></p></dd>


<dt>modelFile</dt>
<dd><p>character. Text file name to save model to</p></dd>


<dt>nimble</dt>
<dd><p>logical. If TRUE, model code will be for Nimble (incompatible with JAGS). If FALSE, model code is for JAGS.</p></dd>


<dt>keyword_quadratic</dt>
<dd><p>character. A suffix in covariate names in the model that indicates a covariate is a quadratic effect of another covariate which does not carry the suffix in its name (e.g. if the covariate is "elevation", the quadratic covariate would be "elevation_squared").</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p><code>commOccu</code> object. It is an S4 class containing all information required to run the models. See  <code><a href="commOccu-class.html">commOccu-class</a></code> for details.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>For examples of implementation, see Vignette 5: Multi-species occupancy models.</p>
<p>Fixed effects of covariates are constant across species, whereas random effect covariates differ between species. Independent effect differ between species and are independent (there is no underlying hyperdistribution).
Fixed, independent and random effects are allowed for station-level detection and occupancy covariates (a.k.a. site covariates). Fixed and random effects are also allowed for station-occasion level covariates (a.k.a. observation covariates). 
Currently independent effects are only supported for continuous site covariates, not categorical site covariates or observation-level covariates.</p>
<p>By default, random effects will be by species. It is however possible to use categorical site covariates for grouping (continuous|categorical).
Furthermore, is is possible to use use nested random effects of species and another categorical site covariate (so that there is a random effect of species and an additional random effect of a categorical covariate within each species).</p>

<p>Derived quantities returned by the model are:</p>  
<p></p><table class="table table"><tr><td><code>Bpvalue</code></td><td>Bayesian p-value (overall)</td></tr><tr><td><code>Bpvalue_species</code></td><td>Bayesian p-value (by species)</td></tr><tr><td><code>Nspecies</code></td><td>Species richness (only in JAGS models)</td></tr><tr><td><code>Nspecies_station</code></td><td>Species richness at each sampling locations (only in JAGS models)</td></tr><tr><td><code>Nspecies_Covariate</code></td><td>Species richness by categorical covariate (when using <code>richnessCategories</code>, only in JAGS models)</td></tr><tr><td><code>R2</code></td><td>sum of Freeman-Tukey residuals of observed data within each species</td></tr><tr><td><code>new.R2</code></td><td>sum of Freeman-Tukey residuals of simulated data within each species</td></tr><tr><td><code>R3</code></td><td>Total sum of Freeman-Tukey residuals of observed data</td></tr><tr><td><code>new.R3</code></td><td>Total sum of Freeman-Tukey residuals of simulated data</td></tr><tr><td><em><code>Ntotal</code></em></td><td>Total metacommunity size (= observed species + n0)</td></tr><tr><td><em><code>n0</code></em></td><td>Number of unseen species in metacommunity</td></tr><tr><td><em><code>omega</code></em></td><td>Data augmentation parameter</td></tr><tr><td><em><code>w</code></em></td><td>Metacommunity membership indicator for each species</td></tr></table><p>Quantities in <em>italic</em> at the bottom are only returned in full data augmentation. <code>Nspecies</code> and <code>Nspecies_Covariate</code> are only returned in JAGS models (because Nimble models don't explicitly return latent occupancy status z).</p>
    </div>
    <div id="parameter-naming-convention">
    <h2>Parameter naming convention</h2>
    
 
<p>The parameter names are assembled from building blocks. The nomenclature  is as follows:</p><table class="table table"><tr><td><b>Name</b></td><td><b>Refers to</b></td><td><b>Description</b></td></tr><tr><td><b><code>alpha</code></b></td><td>Submodel</td><td>detection submodel</td></tr><tr><td><b><code>beta</code></b></td><td>Submodel</td><td>occupancy submode</td></tr><tr><td><b><code>0</code></b></td><td>Intercept</td><td>denotes the intercepts (alpha0, beta0)</td></tr><tr><td><b><code>fixed</code></b></td><td>Effect type</td><td>fixed effects (constant across species)</td></tr><tr><td><b><code>indep</code></b></td><td>Effect type</td><td>independent effects (separate for each species)</td></tr><tr><td><b><code>ranef</code></b></td><td>Effect type</td><td>random effects (of species and/or other categorical covariates)</td></tr><tr><td><b><code>cont</code></b></td><td>Covariate type</td><td>continuous covariates</td></tr><tr><td><b><code>categ</code></b></td><td>Covariate type</td><td>categorical covariates</td></tr><tr><td><b><code>mean</code></b></td><td>Hyperparameter</td><td>mean of random effect</td></tr><tr><td><b><code>sigma</code></b></td><td>Hyperparameter</td><td>standard deviation of random effect</td></tr><tr><td><b><code>tau</code></b></td><td>Hyperparameter</td><td>precision of random effect (used internally, not returned)</td></tr></table><p>For example, a fixed intercept of occupancy (constant across species) is <b><code>beta0</code></b>, and a fixed intercept of detection probability is <b><code>alpha0</code></b>.</p>

<p>An occupancy probability intercept with a random effect of species is:</p>  
<p><b><code>beta0.mean</code></b> community mean of the occupancy probability intercept</p>
<p><b><code>beta0.sigma</code></b> standard deviation of the community occupancy probability intercept.</p>
<p><b><code>beta0[1]</code></b> occupancy probability intercept of species 1 (likewise for other species).</p>

<p>For effects of site covariates, the pattern is:</p>  
<p><code>submodel.effectType.covariateType.CovariateName.hyperparameter</code></p>
<p>For example:</p>  
<p><b><code>beta.ranef.cont.habitat.mean</code></b> is the mean community effect of the continuous site covariate 'habitat' on occupancy probability.</p>
<p><b><code>beta.ranef.cont.habitat[1]</code></b> is the effect of continuous site covariate 'habitat' on occupancy probability of species 1.</p>
<p>Site-occasion covariates are denoted by ".obs" after the submodel, e.g.:</p>  
<p><b><code>alpha.obs.fixed.cont.effort</code></b> is the fixed effect of the continuous observation-level covariate 'effort' on detection probability</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Kéry, M., and J. A. Royle. "Applied hierarchical modelling in ecology - Modeling distribution, abundance and species richness using R and BUGS." Volume 1: Prelude and Static Models. Elsevier/Academic Press, 2016.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Juergen Niedballa</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"camtraps"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create camera operation matrix</span></span></span>
<span class="r-in"><span><span class="va">camop_no_problem</span> <span class="op">&lt;-</span> <span class="fu"><a href="cameraOperation.html">cameraOperation</a></span><span class="op">(</span>CTtable      <span class="op">=</span> <span class="va">camtraps</span>,</span></span>
<span class="r-in"><span>                                    stationCol   <span class="op">=</span> <span class="st">"Station"</span>,</span></span>
<span class="r-in"><span>                                    setupCol     <span class="op">=</span> <span class="st">"Setup_date"</span>,</span></span>
<span class="r-in"><span>                                    retrievalCol <span class="op">=</span> <span class="st">"Retrieval_date"</span>,</span></span>
<span class="r-in"><span>                                    hasProblems  <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>                                    dateFormat   <span class="op">=</span> <span class="st">"dmy"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"recordTableSample"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># make list of detection histories</span></span></span>
<span class="r-in"><span><span class="va">DetHist_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">recordTableSample</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="detectionHistory.html">detectionHistory</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    recordTable         <span class="op">=</span> <span class="va">recordTableSample</span>,</span></span>
<span class="r-in"><span>    camOp                <span class="op">=</span> <span class="va">camop_no_problem</span>,</span></span>
<span class="r-in"><span>    stationCol           <span class="op">=</span> <span class="st">"Station"</span>,</span></span>
<span class="r-in"><span>    speciesCol           <span class="op">=</span> <span class="st">"Species"</span>,</span></span>
<span class="r-in"><span>    recordDateTimeCol    <span class="op">=</span> <span class="st">"DateTimeOriginal"</span>,</span></span>
<span class="r-in"><span>    species              <span class="op">=</span> <span class="va">x</span>,</span></span>
<span class="r-in"><span>    occasionLength       <span class="op">=</span> <span class="fl">7</span>,</span></span>
<span class="r-in"><span>    day1                 <span class="op">=</span> <span class="st">"station"</span>,</span></span>
<span class="r-in"><span>    datesAsOccasionNames <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>    includeEffort        <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>    scaleEffort          <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>    timeZone             <span class="op">=</span> <span class="st">"Asia/Kuala_Lumpur"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># assign species names to list items</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">DetHist_list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">recordTableSample</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># extract detection histories (omit effort matrices)</span></span></span>
<span class="r-in"><span><span class="va">ylist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">DetHist_list</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">detection_history</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create some fake covariates for demonstration</span></span></span>
<span class="r-in"><span><span class="va">sitecovs</span> <span class="op">&lt;-</span> <span class="va">camtraps</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">sitecovs</span><span class="op">$</span><span class="va">elevation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">300</span>, <span class="fl">500</span>, <span class="fl">600</span><span class="op">)</span>   </span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># scale numeric covariates</span></span></span>
<span class="r-in"><span><span class="va">sitecovs</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">sitecovs</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># bundle input data for communityModel</span></span></span>
<span class="r-in"><span><span class="va">data_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ylist <span class="op">=</span> <span class="va">ylist</span>,</span></span>
<span class="r-in"><span>                  siteCovs <span class="op">=</span> <span class="va">sitecovs</span>,</span></span>
<span class="r-in"><span>                  obsCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>effort <span class="op">=</span> <span class="va">DetHist_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">effort</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create community model for JAGS</span></span></span>
<span class="r-in"><span><span class="va">modelfile1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".txt"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mod.jags</span> <span class="op">&lt;-</span> <span class="fu">communityModel</span><span class="op">(</span><span class="va">data_list</span>,</span></span>
<span class="r-in"><span>                           occuCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="st">"utm_y"</span>, ranef <span class="op">=</span> <span class="st">"elevation"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           detCovsObservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="st">"effort"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           intercepts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"ranef"</span>, occu <span class="op">=</span> <span class="st">"ranef"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           modelFile <span class="op">=</span> <span class="va">modelfile1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod.jags</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># fit in JAGS</span></span></span>
<span class="r-in"><span><span class="va">fit.jags</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">mod.jags</span>,</span></span>
<span class="r-in"><span>                n.iter <span class="op">=</span> <span class="fl">1000</span>,</span></span>
<span class="r-in"><span>                n.burnin <span class="op">=</span> <span class="fl">500</span>,</span></span>
<span class="r-in"><span>                chains <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>   </span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit.jags</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># response curves (= marginal effect plots)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_effects-commOccu-method.html">plot_effects</a></span><span class="op">(</span><span class="va">mod.jags</span>, </span></span>
<span class="r-in"><span>             <span class="va">fit.jags</span>, </span></span>
<span class="r-in"><span>             submodel <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_effects-commOccu-method.html">plot_effects</a></span><span class="op">(</span><span class="va">mod.jags</span>, </span></span>
<span class="r-in"><span>             <span class="va">fit.jags</span>, </span></span>
<span class="r-in"><span>             submodel <span class="op">=</span> <span class="st">"det"</span><span class="op">)</span></span></span>
<span class="r-in"><span>             </span></span>
<span class="r-in"><span><span class="co"># effect sizes plot</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_coef-commOccu-method.html">plot_coef</a></span><span class="op">(</span><span class="va">mod.jags</span>, </span></span>
<span class="r-in"><span>          <span class="va">fit.jags</span>, </span></span>
<span class="r-in"><span>          submodel <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_coef-commOccu-method.html">plot_coef</a></span><span class="op">(</span><span class="va">mod.jags</span>, </span></span>
<span class="r-in"><span>          <span class="va">fit.jags</span>, </span></span>
<span class="r-in"><span>          submodel <span class="op">=</span> <span class="st">"det"</span><span class="op">)</span>              </span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create community model for Nimble</span></span></span>
<span class="r-in"><span><span class="va">modelfile2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".txt"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mod.nimble</span> <span class="op">&lt;-</span> <span class="fu">communityModel</span><span class="op">(</span><span class="va">data_list</span>,</span></span>
<span class="r-in"><span>                             occuCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="st">"utm_x"</span>, ranef <span class="op">=</span> <span class="st">"utm_y"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                             detCovsObservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="st">"effort"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                             intercepts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"ranef"</span>, occu <span class="op">=</span> <span class="st">"ranef"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                             modelFile <span class="op">=</span> <span class="va">modelfile2</span>, </span></span>
<span class="r-in"><span>                             nimble <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>      <span class="co"># set nimble = TRUE</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># load nimbleEcology package </span></span></span>
<span class="r-in"><span><span class="co"># currently necessary to do explicitly, to avoid additional package dependencies</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nimble-dev/nimbleEcology" class="external-link">nimbleEcology</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># fit uncompiled model in Nimble</span></span></span>
<span class="r-in"><span><span class="va">fit.nimble.uncomp</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">mod.nimble</span>, </span></span>
<span class="r-in"><span>                         n.iter <span class="op">=</span> <span class="fl">10</span>, </span></span>
<span class="r-in"><span>                         chains <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># fit compiled model in Nimble</span></span></span>
<span class="r-in"><span><span class="va">fit.nimble.comp</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">mod.nimble</span>, </span></span>
<span class="r-in"><span>                       n.iter <span class="op">=</span> <span class="fl">5000</span>, </span></span>
<span class="r-in"><span>                       n.burnin <span class="op">=</span> <span class="fl">2500</span>,</span></span>
<span class="r-in"><span>                       chains <span class="op">=</span> <span class="fl">3</span>, </span></span>
<span class="r-in"><span>                       compile <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># parameter summary statistics</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit.nimble.comp</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># response curves (= marginal effect plots)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_effects-commOccu-method.html">plot_effects</a></span><span class="op">(</span><span class="va">mod.nimble</span>, </span></span>
<span class="r-in"><span>             <span class="va">fit.nimble.comp</span>, </span></span>
<span class="r-in"><span>             submodel <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_effects-commOccu-method.html">plot_effects</a></span><span class="op">(</span><span class="va">mod.nimble</span>, </span></span>
<span class="r-in"><span>             <span class="va">fit.nimble.comp</span>, </span></span>
<span class="r-in"><span>             submodel <span class="op">=</span> <span class="st">"det"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># effect sizes plot</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_coef-commOccu-method.html">plot_coef</a></span><span class="op">(</span><span class="va">mod.nimble</span>, </span></span>
<span class="r-in"><span>          <span class="va">fit.nimble.comp</span>, </span></span>
<span class="r-in"><span>          submodel <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_coef-commOccu-method.html">plot_coef</a></span><span class="op">(</span><span class="va">mod.nimble</span>, </span></span>
<span class="r-in"><span>          <span class="va">fit.nimble.comp</span>, </span></span>
<span class="r-in"><span>          submodel <span class="op">=</span> <span class="st">"det"</span><span class="op">)</span>   </span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># traceplots</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit.nimble.comp</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Juergen Niedballa, Alexandre Courtiol, Rahel Sollmann.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

